<!-- index.html — Course Score Calculator (single-file React app, CDN) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Course Score Calculator</title>
  <!-- Tailwind CDN (small projects only) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-slate-100 min-h-screen">
  <div id="root" class="py-12"></div>

  <script type="text/javascript">
  const { useState, useEffect } = React;

  function round(v) { return Math.round((v + Number.EPSILON) * 100) / 100; }

  function letterGrade(T) {
    if (T >= 90) return { letter: "S", point: 10 };
    if (T >= 80) return { letter: "A", point: 9 };
    if (T >= 70) return { letter: "B", point: 8 };
    if (T >= 60) return { letter: "C", point: 7 };
    if (T >= 50) return { letter: "D", point: 6 };
    if (T >= 40) return { letter: "E", point: 4 };
    return { letter: "U", point: 0 };
  }

  function computeResults(wks, q1, q2, F) {
    const sum = wks.reduce((a,b)=>a + Number(b||0), 0);
    const GAA = sum / 10;
    const gaaTerm = 0.1 * GAA;
    const optA = 0.6 * F + 0.2 * Math.max(q1, q2);
    const optB = 0.4 * F + 0.2 * q1 + 0.3 * q2;
    const insideMax = Math.max(optA, optB);
    const T = gaaTerm + insideMax;
    return {
      sum, GAA: round(GAA), gaaTerm: round(gaaTerm),
      optA: round(optA), optB: round(optB), insideMax: round(insideMax),
      T: round(T), grade: letterGrade(round(T))
    };
  }

  function App(){
    const defaultWeekly = Array.from({length:10}, ()=>0);
    const [weekly, setWeekly] = useState(defaultWeekly);
    const [quiz1, setQuiz1] = useState(0);
    const [quiz2, setQuiz2] = useState(0);
    const [finalExam, setFinalExam] = useState(0);
    const [name, setName] = useState("");
    const [subjects, setSubjects] = useState([]);

    // load saved subjects from localStorage
    useEffect(()=> {
      try {
        const raw = localStorage.getItem("courses_v1");
        if (raw) setSubjects(JSON.parse(raw));
      } catch(e){}
    },[]);

    useEffect(()=>{
      try { localStorage.setItem("courses_v1", JSON.stringify(subjects)); } catch(e){}
    },[subjects]);

    function handleWeeklyChange(i, value){
      const v = Math.max(0, Math.min(100, Number(value) || 0));
      const copy = weekly.slice(); copy[i] = v; setWeekly(copy);
    }

    function saveSubject(){
      const s = {
        name: name || `Subject ${subjects.length+1}`,
        weekly, quiz1, quiz2, finalExam,
        computed: computeResults(weekly, quiz1, quiz2, finalExam),
        createdAt: Date.now()
      };
      setSubjects([s, ...subjects]);
      setName("");
    }

    function loadSubject(idx){
      const s = subjects[idx];
      setWeekly(s.weekly);
      setQuiz1(s.quiz1);
      setQuiz2(s.quiz2);
      setFinalExam(s.finalExam);
      setName(s.name);
    }

    function removeSubject(idx){
      if (!confirm("Delete this saved subject?")) return;
      setSubjects(subjects.filter((_,i)=>i!==idx));
    }

    function resetForm(){
      setWeekly(defaultWeekly.slice());
      setQuiz1(0); setQuiz2(0); setFinalExam(0); setName("");
    }

    function exportCSV(){
      const rows = ["name,weekly_sum,gaa,quiz1,quiz2,final,T,letter"];
      subjects.forEach(s=>{
        const r = [
          '"' + s.name.replace(/"/g,'""') + '"',
          s.computed.sum,
          s.computed.GAA,
          s.quiz1, s.quiz2, s.finalExam, s.computed.T, s.computed.grade.letter
        ];
        rows.push(r.join(","));
      });
      const blob = new Blob([rows.join("\\n")], {type:"text/csv"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a"); a.href = url; a.download = "courses.csv"; a.click();
      URL.revokeObjectURL(url);
    }

    function importCSV(file){
      const reader = new FileReader();
      reader.onload = (e)=>{
        const text = e.target.result;
        const lines = text.split(/\\r?\\n/).map(l=>l.trim()).filter(Boolean);
        // naive parser: expect header then rows
        const imported = [];
        for (let i=1;i<lines.length;i++){
          const cols = lines[i].split(",");
          if (cols.length < 8) continue;
          try {
            const name = cols[0].replace(/^"|"$/g,"");
            const sum = Number(cols[1]);
            const gaa = Number(cols[2]);
            const q1 = Number(cols[3]);
            const q2 = Number(cols[4]);
            const f = Number(cols[5]);
            // can't reconstruct weekly array reliably from CSV; set last two as fakes to preserve sums
            const weekly = Array.from({length:10}, ()=> Math.round(gaa));
            const computed = computeResults(weekly, q1, q2, f);
            imported.push({ name, weekly, quiz1: q1, quiz2: q2, finalExam: f, computed, createdAt: Date.now() });
          } catch(e){}
        }
        if (imported.length) setSubjects([...imported, ...subjects]);
        alert(`Imported ${imported.length} rows (best-effort).`);
      };
      reader.readAsText(file);
    }

    function findFinalForTarget(target){
      for (let f=0; f<=100; f+=0.1){
        const res = computeResults(weekly, quiz1, quiz2, f);
        if (res.T >= target) return round(f);
      }
      return null;
    }

    const results = computeResults(weekly, quiz1, quiz2, finalExam);

    return (
      React.createElement("div", {className:"max-w-5xl mx-auto p-6"},
        React.createElement("h1", {className:"text-2xl font-bold mb-4"}, "Course Score Calculator"),
        React.createElement("div", {className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},
          // left: form
          React.createElement("div", {className:"space-y-4"},
            React.createElement("div", {className:"flex gap-2"},
              React.createElement("input", {
                className:"flex-1 p-2 rounded border",
                placeholder:"Subject name (optional)", value:name,
                onChange:e=>setName(e.target.value)
              }),
              React.createElement("button", {className:"px-3 py-2 rounded bg-indigo-600 text-white", onClick:saveSubject}, "Save")
            ),
            React.createElement("div", {className:"grid grid-cols-2 gap-2 bg-white p-3 rounded shadow"},
              weekly.map((val,i)=>(
                React.createElement("div", {key:i, className:"flex items-center gap-2"},
                  React.createElement("label", {className:"w-20 text-sm"}, `Week ${i+1}`),
                  React.createElement("input", {
                    type:"number", min:0, max:100, className:"flex-1 p-2 rounded border",
                    value:val, onChange:e=>handleWeeklyChange(i, e.target.value)
                  })
                )
              ))
            ),
            React.createElement("div", {className:"grid grid-cols-3 gap-2"},
              React.createElement("div", null,
                React.createElement("label", null, "Quiz 1"),
                React.createElement("input", {type:"number", min:0, max:100, className:"w-full p-2 rounded border", value:quiz1, onChange:e=>setQuiz1(Math.max(0,Math.min(100,Number(e.target.value)||0)))})
              ),
              React.createElement("div", null,
                React.createElement("label", null, "Quiz 2"),
                React.createElement("input", {type:"number", min:0, max:100, className:"w-full p-2 rounded border", value:quiz2, onChange:e=>setQuiz2(Math.max(0,Math.min(100,Number(e.target.value)||0)))})
              ),
              React.createElement("div", null,
                React.createElement("label", null, "Final Exam"),
                React.createElement("input", {type:"number", min:0, max:100, className:"w-full p-2 rounded border", value:finalExam, onChange:e=>setFinalExam(Math.max(0,Math.min(100,Number(e.target.value)||0)))})
              )
            ),
            React.createElement("div", {className:"flex gap-2"},
              React.createElement("button", {className:"px-3 py-2 rounded border", onClick:resetForm}, "Reset"),
              React.createElement("button", {className:"px-3 py-2 rounded border", onClick:exportCSV}, "Export CSV"),
              React.createElement("label", {className:"px-3 py-2 rounded border cursor-pointer"},
                "Import CSV",
                React.createElement("input", {type:"file", accept:".csv", className:"hidden", onChange:e=>{ if (e.target.files[0]) importCSV(e.target.files[0]); }})
              )
            )
          ),
          // right: results & saved
          React.createElement("div", {className:"space-y-4"},
            React.createElement("div", {className:"p-4 bg-white rounded shadow"},
              React.createElement("h2", {className:"font-semibold mb-2"}, "Computed results"),
              React.createElement("div", {className:"grid grid-cols-2 gap-1 text-sm"},
                React.createElement("div", null, "Weekly sum"), React.createElement("div", {className:"text-right"}, results.sum),
                React.createElement("div", null, "GAA (avg of 10)"), React.createElement("div", {className:"text-right"}, results.GAA),
                React.createElement("div", null, "0.1·GAA"), React.createElement("div", {className:"text-right"}, results.gaaTerm),
                React.createElement("div", null, "Option A (0.6F + 0.2·maxQ)"), React.createElement("div", {className:"text-right"}, results.optA),
                React.createElement("div", null, "Option B (0.4F + 0.2·Q1 + 0.3·Q2)"), React.createElement("div", {className:"text-right"}, results.optB),
                React.createElement("div", null, "Used (max)"), React.createElement("div", {className:"text-right"}, results.insideMax),
                React.createElement("div", {className:"font-bold"}, "Total T"), React.createElement("div", {className:"font-bold text-right"}, results.T),
                React.createElement("div", null, "Letter"), React.createElement("div", {className:"text-right"}, results.grade.letter + " (GP: " + results.grade.point + ")")
              )
            ),
            React.createElement("div", {className:"p-4 bg-white rounded shadow"},
              React.createElement("h3", {className:"font-semibold mb-2"}, "What-if: required final for target T"),
              React.createElement(WhatIf, {weekly, quiz1, quiz2, findFinalForTarget})
            ),
            React.createElement("div", {className:"p-4 bg-white rounded shadow"},
              React.createElement("h3", {className:"font-semibold mb-2"}, "Saved subjects"),
              subjects.length === 0 ? React.createElement("div", {className:"text-sm text-gray-600"}, "No saved subjects") :
                subjects.map((s,i)=>(
                  React.createElement("div", {key:i, className:"flex items-center justify-between p-2 border rounded mb-2 bg-gray-50"},
                    React.createElement("div", null,
                      React.createElement("div", {className:"font-medium"}, s.name),
                      React.createElement("div", {className:"text-sm text-gray-600"}, "T: " + s.computed.T + " • " + s.computed.grade.letter)
                    ),
                    React.createElement("div", {className:"flex gap-2"},
                      React.createElement("button", {className:"px-2 py-1 rounded border text-sm", onClick:()=>loadSubject(i)}, "Load"),
                      React.createElement("button", {className:"px-2 py-1 rounded border text-sm", onClick:()=>removeSubject(i)}, "Remove")
                    )
                  )
                ))
            )
          )
        )
      )
    );
  }

  function WhatIf({weekly, quiz1, quiz2, findFinalForTarget}){
    const [target, setTarget] = useState(70);
    const [answer, setAnswer] = useState(null);
    function go(){ const f = findFinalForTarget(target); setAnswer(f === null ? null : f); }
    return React.createElement("div", null,
      React.createElement("div", {className:"flex gap-2"},
        React.createElement("input",{type:"number", min:0, max:100, value:target, onChange:e=>setTarget(Number(e.target.value||0)), className:"p-2 rounded border w-28"}),
        React.createElement("button",{className:"px-3 py-2 rounded bg-green-600 text-white", onClick:go},"Find final")
      ),
      answer === null ? React.createElement("div", {className:"mt-2 text-sm text-red-600"}, "Target not achievable with 0–100 final.") :
        React.createElement("div", {className:"mt-2 text-sm"}, "Minimum final required: " + answer)
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
